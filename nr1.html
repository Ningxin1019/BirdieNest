<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nest Displacement</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: monospace; /* ä½¿ç”¨ç­‰å®½å­—ä½“è¥é€ å¤å¤æ„Ÿ */
      background-color: #fff;
      color: #000;
      overflow: hidden;
      filter: grayscale(100%); /* æ·»åŠ è¿™ä¸€è¡Œï¼Œä½¿æ•´ä¸ªé¡µé¢å˜æˆé»‘ç™½ */
    }

    .initial-state {
      position: fixed;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .hello {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 14px;
    }

    .start-button {
      font-family: monospace;
      font-size: 16px;
      padding: 10px 20px;
      margin: 20px;
      background: none;
      border: 1px solid #000;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .start-button:hover {
      background-color: #000;
      color: #fff;
    }

    .skip-link {
      font-size: 12px;
      color: #666;
      text-decoration: none;
      margin-top: 10px;
    }

    .skip-link:hover {
      text-decoration: underline;
    }

    /* éšè—çš„å†…å®¹ï¼Œç­‰å¾…è§£é” */
    .hidden {
      display: none;
    }

    /* è§£é”åçš„æ ·å¼å˜åŒ– */
    .stage-1 {
      background-color: #f5f5f5;
      transition: background-color 2s ease;
    }

    .stage-2 {
      font-family: 'Times New Roman', serif;
      transition: font-family 1s ease;
    }

    .stage-3 {
      color: #333;
      transition: color 1s ease;
    }

    /* æ·»åŠ æ–°çš„æ ·å¼ */
    .journey-stage-1 {
      position: fixed;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 1s ease;
    }

    .text-fragment {
      position: absolute;
      padding: 10px;
      background: #fff;
      border: 1px solid #000;
      cursor: move;
      font-size: 14px;
      max-width: 300px;
      text-align: left;
      transition: all 0.3s ease;
      opacity: 0;
      line-height: 1.6;
      user-select: none;
    }

    .text-fragment.visible {
      opacity: 1;
    }

    .text-fragment:hover {
      transform: scale(1.02);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .collected-text {
      font-size: 12px;
      line-height: 1.6;
      margin: 0;
      padding: 5px 0;
      transition: all 0.5s ease;
    }

    .collected-text:not(:last-child) {
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .feather-outline {
      position: absolute;
      width: 500px;
      min-height: 300px;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 2px solid;
      border-color: #dfdfdf #808080 #808080 #dfdfdf;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      font-family: 'MS Sans Serif', Arial, sans-serif;
    }

    /* è®°äº‹æœ¬æ ‡é¢˜æ  */
    .notepad-title {
      background: #000080;
      color: white;
      padding: 3px 5px;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notepad-title-buttons {
      display: flex;
      gap: 2px;
    }

    .title-button {
      width: 16px;
      height: 14px;
      background: #c0c0c0;
      border: 1px solid;
      border-color: #ffffff #808080 #808080 #ffffff;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 10px;
    }

    /* è®°äº‹æœ¬å†…å®¹åŒº */
    .notepad-content {
      flex: 1;
      padding: 10px;
      background: #ffffff;
      border: 1px solid #808080;
      border-top: 2px solid #808080;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
      overflow-y: auto;
      min-height: 250px;
      outline: none;
      caret-color: #000;
    }

    .notepad-content::selection {
      background: #000080;
      color: #fff;
    }

    /* æ–‡æœ¬ç¢ç‰‡çš„åˆå§‹ä½ç½® */
    .text-fragment:nth-child(1) {
      top: 30%;
      left: 20%;
    }

    .text-fragment:nth-child(2) {
      top: 50%;
      right: 25%;
    }

    /* ç®€åŒ–æç¤ºå…ƒç´ çš„æ ·å¼ï¼Œç§»é™¤è¿‡æ¸¡åŠ¨ç”» */
    .unlock-text {
      position: absolute;
      left: 25%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-family: monospace;
      font-size: 18px;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      white-space: nowrap;
      z-index: 1000;
    }

    .unlock-emoji {
      position: absolute;
      right: 25%;
      top: 50%;
      transform: translate(50%, -50%);
      font-size: 48px;
      opacity: 0;
      visibility: hidden;
      z-index: 1000;
      cursor: pointer;
      pointer-events: auto;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* æ·»åŠ å¼¹æ€§åŠ¨ç”» */
    }

    /* æ·»åŠ æ‚¬åœæ•ˆæœ */
    .unlock-emoji:hover {
      transform: translate(50%, -50%) rotate(-15deg) scale(1.2);
      animation: wiggle 0.5s infinite alternate;
    }

    /* æ·»åŠ æ‘‡æ™ƒåŠ¨ç”» */
    @keyframes wiggle {
      0% {
        transform: translate(50%, -50%) rotate(-15deg) scale(1.2);
      }
      100% {
        transform: translate(50%, -50%) rotate(15deg) scale(1.2);
      }
    }

    /* ç®€åŒ–æ˜¾ç¤ºç±» */
    .unlock-text.show,
    .unlock-emoji.show {
      opacity: 1;
      visibility: visible;
    }

    /* ä¿®æ”¹æ˜Ÿå·æŒ‰é’®æ ·å¼ï¼Œç¡®ä¿åªæœ‰ä¸€å¤„å®šä¹‰é¢œè‰² */
    .star-button {
      position: fixed;
      top: 17px;
      left: 20px;
      font-family: monospace;
      font-size: 24px;
      user-select: none;
      z-index: 2000;
      display: none;
      color: #000 !important; /* ä½¿ç”¨ !important ç¡®ä¿é¢œè‰²ä¸è¢«å…¶ä»–æ ·å¼è¦†ç›– */
      pointer-events: none;
    }

    .star-button.unlocked {
      pointer-events: auto;
      cursor: pointer;
      /* ç§»é™¤ä»»ä½•é¢œè‰²ç›¸å…³çš„æ ·å¼ */
    }

    /* ä¿®æ”¹èœå•æ ·å¼ */
    .effects-menu {
      position: fixed;
      top: 0;
      left: 0;
      padding: 20px;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.6;
      display: none;
      z-index: 1999;
      background: white;
    }

    .menu-title {
      margin-bottom: 20px;
      margin-left: 35px; /* ä¸æ˜Ÿå·å¯¹é½ */
      white-space: pre;
    }

    .section-title {
      white-space: pre;
      margin-left: 45px; /* æ¯”æ˜Ÿå·ä½ç½®ç¨å¾®é å³ä¸€ç‚¹ */
      margin-top: -20px; /* ä¸Šç§»åˆ°ä¸æ˜Ÿå·åŒä¸€æ°´å¹³çº¿ */
    }

    .effects-list {
      margin-left: 2px;
      margin-top: 10px; /* ä»20pxæ”¹ä¸º10pxï¼Œå‘ä¸Šç§»åŠ¨10åƒç´  */
      white-space: pre;
    }

    .effect-item {
      display: flex;
      align-items: center;
      gap: 10px; /* æ·»åŠ é€‰é¡¹æ¡†å’Œæ–‡å­—ä¹‹é—´çš„é—´è· */
      color: #888;
      cursor: default;
    }

    .effect-item.unlocked {
      color: #000;
      cursor: pointer;
    }

    .checkbox {
      font-family: monospace;
      user-select: none;
    }

    /* é€‰ä¸­çŠ¶æ€çš„æ ·å¼ */
    .effect-item.checked .checkbox {
      content: '[*]';
    }

    /* ä¿®æ”¹å­èœå•æ ·å¼ */
    .color-submenu {
      position: fixed;
      top: 0;
      right: 0; /* æ”¹ä¸º0ï¼Œç›´æ¥è´´ä½å³è¾¹ */
      background: white;
      padding: 20px;
      font-family: monospace;
      font-size: 14px;
      display: none;
      z-index: 1998;
    }

    .slider-group {
      margin-bottom: 30px; /* å¢åŠ æ»‘å—ç»„ä¹‹é—´çš„é—´è· */
      width: 200px; /* å›ºå®šå®½åº¦ */
    }

    .slider-label {
      margin-bottom: 10px;
      white-space: pre;
    }

    .color-slider {
      width: 100%; /* ä½¿ç”¨çˆ¶å…ƒç´ çš„å®½åº¦ */
      -webkit-appearance: none;
      height: 2px;
      background: #000;
      outline: none;
      position: relative;
    }

    .color-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 10px;
      height: 20px;
      background: #000;
      cursor: pointer;
    }

    /* æ·»åŠ æ»‘å—ä¸¤ç«¯çš„çº¿æ¡ */
    .color-slider::before,
    .color-slider::after {
      content: '';
      position: absolute;
      top: 50%;
      width: 20px;
      height: 2px;
      background: #000;
    }

    .color-slider::before {
      left: -20px;
    }

    .color-slider::after {
      right: -20px;
    }

    /* æ·»åŠ ç¦ç”¨çŠ¶æ€çš„æ ·å¼ */
    .effect-checkbox[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .effect-item {
      opacity: 0.5; /* åˆå§‹çŠ¶æ€æ˜¾ç¤ºä¸ºåŠé€æ˜ */
      transition: opacity 0.3s ease;
    }

    .effect-item.unlocked {
      opacity: 1; /* è§£é”åæ˜¾ç¤ºä¸ºå®Œå…¨ä¸é€æ˜ */
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="initial-state">
    <div class="hello">Hello, world!</div>
    <button class="start-button" onclick="startJourney()">Start</button>
    <a href="#" class="skip-link" onclick="skipToNest()">Skip to nest</a>
  </div>

  <!-- éšè—çš„å†…å®¹ï¼Œç­‰å¾…è§£é” -->
  <div id="journey-content" class="hidden">
    <div class="journey-stage-1">
      <div class="unlock-emoji">ğŸ</div>
      <div class="unlock-text">Colors unlocked</div>
      <div class="feather-outline">
        <div class="notepad-title">
          <span>Untitled - Notepad</span>
          <div class="notepad-title-buttons">
            <button class="title-button">_</button>
            <button class="title-button">â–¡</button>
            <button class="title-button">Ã—</button>
          </div>
        </div>
        <div class="notepad-content" id="dropZone" contenteditable="true" spellcheck="false"></div>
      </div>
    </div>
  </div>

  <div id="nest-generator" class="hidden">
    <!-- æœ€ç»ˆçš„ç”Ÿæˆå™¨å·¥å…· -->
  </div>

  <!-- ä¿®æ”¹èœå•HTMLç»“æ„ -->
  <div class="star-button">*</div>
  <div class="effects-menu">
    <div class="menu-title">Nest Displacement</div>
    <div class="menu-section">
      <div class="section-title">/EFFECTS</div>
      <div class="effects-list">
        <div class="effect-item">
          <span class="checkbox">[ ]</span>
          <span class="effect-name">COLOR</span>
        </div>
      </div>
    </div>
  </div>

  <!-- æ·»åŠ é¢œè‰²æ§åˆ¶å­èœå• -->
  <div class="color-submenu">
    <div class="slider-group">
      <div class="slider-label">HUE</div>
      <input type="range" class="color-slider" id="hueSlider" min="0" max="360" value="180">
    </div>
    <div class="slider-group">
      <div class="slider-label">BRIGHTNESS</div>
      <input type="range" class="color-slider" id="brightnessSlider" min="0" max="100" value="50">
    </div>
    <div class="slider-group">
      <div class="slider-label">SATURATION</div>
      <input type="range" class="color-slider" id="saturationSlider" min="0" max="100" value="50">
    </div>
  </div>

  <script>
    // æ·»åŠ æ–‡æœ¬æ•°ç»„
    const textSequence = [
      "Pet lovebirds often use their beaks to carefully cut pieces of paper and tuck them into their tail feathers.",
      "Despite being born and raised in artificial environments, they retain their instinctual drive as animals to collect diverse materials for nesting.",
      "Consequently, it's common to observe domestic lovebirds decorating themselves with objects produced by human society,",
      "resulting in a quirky yet fascinating sight. Inspired by this behavior,",
      "I've coined a new artistic term, Nest Displacement, to describe instinct-driven creative behaviors within artificial contexts, encompassing adaptation and mutation,",
      "or how individuals seek new possibilities within predefined structures.",
      "Another term, Nest-Grafting, combining the concepts of 'embedding' and 'nesting,'",
      "refers to an individual's appropriation and transformation of surrounding materials, describing artistic actions that incorporate heterogeneous elements into one's own system."
    ];

    let currentTextIndex = 0;
    let isColorUnlocked = false; // æ·»åŠ ä¸€ä¸ªçŠ¶æ€æ ‡è®°
    let isMenuUnlocked = false;

    function startJourney() {
      document.querySelector('.initial-state').style.display = 'none';
      const journeyContent = document.getElementById('journey-content');
      journeyContent.classList.remove('hidden');
      
      // æ˜¾ç¤ºæ˜Ÿå·æŒ‰é’®ï¼Œç¡®ä¿æ˜¯é»‘è‰²
      const starButton = document.querySelector('.star-button');
      starButton.style.display = 'block';
      starButton.style.color = '#000'; // ç¡®ä¿æ˜¾ç¤ºæ—¶å°±æ˜¯é»‘è‰²
      
      setTimeout(() => {
        const stage1 = document.querySelector('.journey-stage-1');
        stage1.style.opacity = '1';
        initDragAndDrop();
        initNotepad();
        showNextText();
      }, 100);
    }

    function skipToNest() {
      document.querySelector('.initial-state').style.display = 'none';
      const nestGenerator = document.getElementById('nest-generator');
      nestGenerator.classList.remove('hidden');
      // ç›´æ¥æ¿€æ´»æ‰€æœ‰åŠŸèƒ½
      activateAllFeatures();
    }

    function initDragAndDrop() {
      const dropZone = document.getElementById('dropZone');
      const notepad = document.querySelector('.feather-outline');
      
      // é˜²æ­¢è®°äº‹æœ¬çª—å£æ¥æ”¶æ‹–æ”¾
      notepad.addEventListener('dragover', (e) => {
        if (e.target !== dropZone && !dropZone.contains(e.target)) {
          e.preventDefault();
          e.stopPropagation();
        }
      });

      // åªå…è®¸å†…å®¹åŒºåŸŸæ¥æ”¶æ‹–æ”¾
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '#f0f0f0';
      });

      dropZone.addEventListener('dragleave', () => {
        dropZone.style.backgroundColor = '#ffffff';
      });

      dropZone.addEventListener('drop', handleDrop);
    }

    function showNextText() {
      if (currentTextIndex >= textSequence.length) {
        // è§£é”èœå•
        const starButton = document.querySelector('.star-button');
        starButton.classList.add('unlocked');
        
        // è§£é” COLOR é€‰é¡¹
        isColorUnlocked = true;
        const colorEffect = document.querySelector('.effect-item');
        colorEffect.classList.add('unlocked');
        const checkbox = colorEffect.querySelector('.checkbox');
        checkbox.disabled = false;
        
        showUnlockEffects();
        startStage2();
        return;
      }

      const fragment = document.createElement('div');
      fragment.className = 'text-fragment';
      fragment.textContent = textSequence[currentTextIndex];
      fragment.draggable = true;
      
      // éšæœºä½ç½®
      const randomPosition = getRandomPosition();
      fragment.style.left = randomPosition.x + 'px';
      fragment.style.top = randomPosition.y + 'px';

      document.querySelector('.journey-stage-1').appendChild(fragment);

      // æ·»åŠ æ‹–æ‹½äº‹ä»¶
      fragment.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', fragment.textContent);
        e.target.style.opacity = '0.5';
      });

      fragment.addEventListener('dragend', (e) => {
        e.target.style.opacity = '1';
      });

      setTimeout(() => fragment.classList.add('visible'), 100);
    }

    function handleDrop(e) {
      e.preventDefault();
      
      // ç¡®ä¿åªæœ‰å†…å®¹åŒºåŸŸå¯ä»¥æ¥æ”¶æ‹–æ”¾
      const dropZone = document.getElementById('dropZone');
      if (e.target !== dropZone && !dropZone.contains(e.target)) {
        return; // å¦‚æœä¸æ˜¯æ‹–åˆ°å†…å®¹åŒºåŸŸï¼Œç›´æ¥è¿”å›
      }

      dropZone.style.backgroundColor = '#ffffff';

      // è·å–æ‹–åŠ¨çš„æ–‡æœ¬
      const text = e.dataTransfer.getData('text/plain');
      
      // è·å–å½“å‰å…‰æ ‡ä½ç½®æˆ–æœ«å°¾
      const selection = window.getSelection();
      let range;
      
      if (selection.rangeCount > 0) {
        range = selection.getRangeAt(0);
      } else {
        range = document.createRange();
        range.selectNodeContents(dropZone);
        range.collapse(false);
      }

      // åœ¨å…‰æ ‡ä½ç½®æ’å…¥æ–‡æœ¬
      const textNode = document.createTextNode(
        (dropZone.textContent ? '\n\n' : '') + text
      );
      range.insertNode(textNode);

      // ç§»åŠ¨å…‰æ ‡åˆ°æ’å…¥æ–‡æœ¬çš„æœ«å°¾
      range.setStartAfter(textNode);
      range.setEndAfter(textNode);
      selection.removeAllRanges();
      selection.addRange(range);

      // ç§»é™¤åŸå§‹æ‹–åŠ¨çš„æ–‡æœ¬
      const draggedText = document.querySelector('.text-fragment');
      draggedText.remove();

      // æ˜¾ç¤ºä¸‹ä¸€æ®µæ–‡æœ¬
      currentTextIndex++;
      showNextText();

      // ä¿æŒç„¦ç‚¹
      dropZone.focus();
    }

    function getRandomPosition() {
      const padding = 50;
      const maxWidth = window.innerWidth - 400;
      const maxHeight = window.innerHeight - 100;
      
      // é¿å…ç”Ÿæˆåœ¨ä¸­å¤®åŒºåŸŸ
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;
      let x, y;
      
      do {
        x = padding + Math.random() * (maxWidth - padding * 2);
      } while (Math.abs(x - centerX) < 300);
      
      do {
        y = padding + Math.random() * (maxHeight - padding * 2);
      } while (Math.abs(y - centerY) < 200);

      return { x, y };
    }

    function startStage2() {
      document.body.classList.add('stage-1');
      // ä¸å†è‡ªåŠ¨ç§»é™¤æ»¤é•œï¼Œç­‰å¾…ç”¨æˆ·ç‚¹å‡»ç¤¼ç‰©
    }

    function activateAllFeatures() {
      // æ¿€æ´»æ‰€æœ‰é«˜çº§åŠŸèƒ½
      document.body.classList.add('stage-1', 'stage-2', 'stage-3');
      // åˆå§‹åŒ–ç”Ÿæˆå™¨å·¥å…·
      initNestGenerator();
      initDragAndDrop();
    }

    function initNestGenerator() {
      // è¿™é‡Œå°†å®ç°æœ€ç»ˆçš„ç”Ÿæˆå™¨å·¥å…·åŠŸèƒ½
    }

    // æ·»åŠ è®°äº‹æœ¬åˆå§‹åŒ–å‡½æ•°
    function initNotepad() {
      const dropZone = document.getElementById('dropZone');
      
      // è‡ªåŠ¨èšç„¦
      dropZone.focus();

      // æ·»åŠ å¿«æ·é”®æ”¯æŒ
      dropZone.addEventListener('keydown', (e) => {
        // Tabé”®æ”¯æŒ
        if (e.key === 'Tab') {
          e.preventDefault();
          const selection = window.getSelection();
          const range = selection.getRangeAt(0);
          const tabNode = document.createTextNode('    '); // 4ä¸ªç©ºæ ¼
          range.insertNode(tabNode);
          range.setStartAfter(tabNode);
          range.setEndAfter(tabNode);
          selection.removeAllRanges();
          selection.addRange(range);
        }
      });
    }

    // æ·»åŠ éšæœºé¢œè‰²ç”Ÿæˆå‡½æ•°
    function getRandomPastelColor() {
      // ç”ŸæˆæŸ”å’Œçš„é¢œè‰²
      const hue = Math.floor(Math.random() * 360); // éšæœºè‰²ç›¸
      const saturation = 30 + Math.random() * 20; // 30-50%çš„é¥±å’Œåº¦
      const lightness = 85 + Math.random() * 10; // 85-95%çš„äº®åº¦
      return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
    }

    // ä¿®æ”¹ showUnlockEffects å‡½æ•°
    function showUnlockEffects() {
      const emoji = document.querySelector('.unlock-emoji');
      const text = document.querySelector('.unlock-text');
      const notepad = document.querySelector('.feather-outline');
      
      // è·å–è®°äº‹æœ¬çš„ä½ç½®ä¿¡æ¯
      const notepadRect = notepad.getBoundingClientRect();
      const windowWidth = window.innerWidth;
      
      // è®¡ç®—å·¦å³åŒºåŸŸçš„ä¸­ç‚¹
      const leftAreaCenter = notepadRect.left / 2;
      const rightAreaCenter = (windowWidth - notepadRect.right) / 2 + notepadRect.right;
      
      // è®¾ç½®æ–‡å­—å’Œemojiçš„ä½ç½®
      text.style.left = `${leftAreaCenter}px`;
      emoji.style.right = `${windowWidth - rightAreaCenter}px`;
      
      // æ˜¾ç¤ºå…ƒç´ 
      text.classList.add('show');
      emoji.classList.add('show');

      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      emoji.addEventListener('click', unlockColors);
    }

    // ä¿®æ”¹ unlockColors å‡½æ•°
    function unlockColors() {
      const emoji = document.querySelector('.unlock-emoji');
      const text = document.querySelector('.unlock-text');
      
      // ç§»é™¤é»‘ç™½æ»¤é•œ
      document.body.style.transition = 'filter 1s ease, background-color 1s ease';
      document.body.style.filter = 'grayscale(0%)';
      
      // è®¾ç½®éšæœºèƒŒæ™¯è‰²
      document.body.style.backgroundColor = getRandomPastelColor();
      
      // ç§»é™¤æç¤ºå…ƒç´ 
      emoji.style.visibility = 'hidden';
      text.style.visibility = 'hidden';
      
      // è§£é”èœå•
      isMenuUnlocked = true;
      const starButton = document.querySelector('.star-button');
      starButton.classList.add('unlocked');
      
      // è§£é” COLOR é€‰é¡¹
      isColorUnlocked = true;
      const colorEffect = document.querySelector('.effect-item');
      colorEffect.classList.add('unlocked');
      const checkbox = colorEffect.querySelector('.checkbox');
      checkbox.disabled = false;
      
      // ç§»é™¤ç‚¹å‡»äº‹ä»¶ï¼Œé˜²æ­¢é‡å¤è§¦å‘
      emoji.removeEventListener('click', unlockColors);
    }

    // æ·»åŠ ä½ç½®æ£€æŸ¥å’Œè°ƒæ•´å‡½æ•°
    function adjustSubmenuPosition() {
      const submenu = document.querySelector('.color-submenu');
      if (!submenu || submenu.style.display === 'none') return;

      const rect = submenu.getBoundingClientRect();
      const windowHeight = window.innerHeight;

      // æ£€æŸ¥æ˜¯å¦è¶…å‡ºè§†çª—åº•éƒ¨
      if (rect.bottom > windowHeight) {
        // è°ƒæ•´ä½ç½®ï¼Œç¡®ä¿åœ¨è§†çª—å†…
        submenu.style.top = 'auto';
        submenu.style.bottom = '20px';
        submenu.style.transform = 'none';
      }
    }

    // ä¿®æ”¹é¢œè‰²æ§åˆ¶é€»è¾‘
    function initializeColorControl() {
      const colorEffect = document.querySelector('.effect-item');
      const colorSubmenu = document.querySelector('.color-submenu');
      const hueSlider = document.getElementById('hueSlider');
      const brightnessSlider = document.getElementById('brightnessSlider');
      const saturationSlider = document.getElementById('saturationSlider');
      let isChecked = false;

      // ç‚¹å‡» COLOR é€‰é¡¹çš„å¤„ç†
      colorEffect.addEventListener('click', (e) => {
        if (!colorEffect.classList.contains('unlocked')) return;

        isChecked = !isChecked;
        const checkbox = colorEffect.querySelector('.checkbox');
        checkbox.textContent = isChecked ? '[*]' : '[ ]';
        colorEffect.classList.toggle('checked');
        colorSubmenu.style.display = isChecked ? 'block' : 'none';
      });

      // æ»‘å—æ§åˆ¶é¢œè‰²
      function updateColor() {
        const hue = hueSlider.value;
        const brightness = brightnessSlider.value;
        const saturation = saturationSlider.value;
        
        document.body.style.backgroundColor = 
          `hsl(${hue}, ${saturation}%, ${brightness}%)`;
      }

      // æ·»åŠ æ»‘å—äº‹ä»¶ç›‘å¬
      hueSlider.addEventListener('input', updateColor);
      brightnessSlider.addEventListener('input', updateColor);
      saturationSlider.addEventListener('input', updateColor);
    }

    // ä¿®æ”¹æ˜Ÿå·æŒ‰é’®çš„åˆå§‹åŒ–
    function initializeMenu() {
      const starButton = document.querySelector('.star-button');
      const menu = document.querySelector('.effects-menu');
      let isMenuOpen = false;

      starButton.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!isMenuUnlocked) return;

        isMenuOpen = !isMenuOpen;
        menu.style.display = isMenuOpen ? 'block' : 'none';
      });

      document.addEventListener('click', (e) => {
        if (isMenuOpen && !menu.contains(e.target)) {
          isMenuOpen = false;
          menu.style.display = 'none';
        }
      });

      initializeColorControl();
    }

    // æ·»åŠ çª—å£å¤§å°æ”¹å˜æ—¶çš„ä½ç½®è°ƒæ•´
    window.addEventListener('resize', adjustSubmenuPosition);

    document.addEventListener('DOMContentLoaded', initializeMenu);
  </script>
</body>
</html>